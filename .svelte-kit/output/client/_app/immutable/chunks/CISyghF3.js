import{s as o}from"./DG2cR9Zm.js";async function u(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("Push notifications not supported in this browser"),!1;try{const e=await navigator.serviceWorker.ready;if(await Notification.requestPermission()!=="granted")return console.warn("Notification permission denied"),!1;const n="BI7C2b_G5S8q0VXR_p6mJRg6V9i_x6Z9V8n3_V8V8V8V8V8V8V8V8V8V8V8V8V8V8V8V8V8V8V8V8";let i=await e.pushManager.getSubscription();i||(i=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:s(n)}));const{data:{user:r}}=await o.auth.getUser();return r&&await o.from("profiles").update({push_subscription:i}).eq("id",r.id),new Notification("Smart E-VISION",{body:"Push notifications enabled! You will now receive compliance alerts.",icon:"/icon-192.png"}),!0}catch(e){return console.error("Push registration failed:",e),!1}}function s(e){const a="=".repeat((4-e.length%4)%4),n=(e+a).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(n),r=new Uint8Array(i.length);for(let t=0;t<i.length;++t)r[t]=i.charCodeAt(t);return r}export{u as subscribeToPush};
