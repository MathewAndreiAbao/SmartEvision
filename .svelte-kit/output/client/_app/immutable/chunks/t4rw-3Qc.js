import{w as l}from"./D02y27Ec.js";import{s as o}from"./DG2cR9Zm.js";const a=l(null),c=l(null),f=l(!0);let u=!1,i=null;async function w(){if(!u)return i||(i=d(),i)}async function d(){if(!u){f.set(!0);try{console.log("[v0] Auth: starting session check...");const e=o.auth.getSession(),t=new Promise((g,n)=>setTimeout(()=>n(new Error("Session check timeout")),2e4)),{data:{session:r},error:s}=await Promise.race([e,t]);s&&console.error("[v0] Error getting session:",s.message),r?.user&&(a.set(r.user),await h(r.user.id)),o.auth.onAuthStateChange(async(g,n)=>{n?.user?(a.set(n.user),await h(n.user.id)):(a.set(null),c.set(null))}),u=!0}catch(e){console.error("[v0] Auth initialization error:",e instanceof Error?e.message:String(e)),u=!0}finally{f.set(!1)}}}async function h(e){const{data:t,error:r}=await o.from("profiles").select("id, full_name, role, school_id, district_id, avatar_url").eq("id",e).single();r?(console.error("Error fetching profile:",r.message),c.set(null)):t&&c.set(t)}async function y(e,t){try{const{error:r}=await o.auth.signInWithPassword({email:e,password:t});return r?(console.error("[v0] Sign in error:",r.message),{error:r.message}):{error:null}}catch(r){const s=r instanceof Error?r.message:"An unexpected error occurred during sign in";return console.error("[v0] Sign in exception:",s),{error:s}}}async function b(){await o.auth.signOut(),a.set(null),c.set(null)}function v(e){switch(e){case"District Supervisor":return"/dashboard/monitoring/district";case"School Head":return"/dashboard/monitoring/school";case"Master Teacher":return"/dashboard/master-teacher";default:return"/dashboard"}}export{f as a,b,v as g,w as i,c as p,y as s,a as u};
