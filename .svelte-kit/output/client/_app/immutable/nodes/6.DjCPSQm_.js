import{d as xt,b as M,a as v,f as u,s as p}from"../chunks/zt7kUNSb.js";import{p as gt,d as T,f as se,o as mt,h as oe,t as U,a as bt,e as ft,c as a,s as o,b as x,$ as _t,n as P,r as t,g as e,i as we}from"../chunks/D02y27Ec.js";import{i as z}from"../chunks/CyaklKEO.js";import{e as X,i as re}from"../chunks/CUJHGDU6.js";import{t as G,f as ie,a as le}from"../chunks/Mk7LNAF3.js";import{h as ht,s as V,a as E,b as Y,r as Oe,c as yt}from"../chunks/DG2cR9Zm.js";import{b as Ne}from"../chunks/7bhswH3j.js";import{a as wt,s as kt}from"../chunks/HxVFllSf.js";import{p as St}from"../chunks/t4rw-3Qc.js";import{S as qe}from"../chunks/DrneAqZx.js";import{U as Be,S as $t,a as Rt,b as Ct}from"../chunks/D-V_Qk3z.js";import{S as At}from"../chunks/C5CMo2Ol.js";import{R as Ut}from"../chunks/EVh9RYOs.js";var zt=u('<div class="h-32 glass-card-static animate-pulse"></div>'),Dt=u('<div class="space-y-4"></div>'),Lt=u("<button><div></div></button> <span> </span>",1),jt=u('<input type="text" class="bg-white border border-gray-200 rounded-lg px-3 py-2 text-sm font-bold w-24 focus:ring-2 focus:ring-gov-blue/20 outline-none"/> <button class="px-4 py-2 bg-gov-blue text-white rounded-lg text-xs font-bold hover:bg-gov-blue-dark active:scale-95 transition-all">Update</button>',1),It=u('<div class="glass-card p-6 flex flex-col md:flex-row md:items-center justify-between gap-6"><div class="max-w-md"><h3 class="font-bold text-text-primary uppercase tracking-wider text-xs mb-1"> </h3> <p class="text-sm text-text-secondary leading-relaxed"> </p></div> <div class="flex items-center gap-3"><!></div></div>'),Mt=u('<div class="grid gap-6"></div>'),Tt=u('<div id="settings-panel" role="tabpanel" aria-labelledby="settings-tab"><!></div>'),Et=u('<div class="glass-card-static p-4 text-center"><p class="text-2xl font-black text-text-primary"> </p> <p class="text-[10px] text-text-muted font-bold uppercase tracking-widest mt-1"> </p></div>'),Ot=u('<div class="h-16 glass-card-static animate-pulse"></div>'),Nt=u('<div class="space-y-3"></div>'),qt=u('<span class="inline-flex items-center gap-1 text-[10px] font-bold text-gov-green uppercase"><!> Active</span>'),Bt=u('<span class="inline-flex items-center gap-1 text-[10px] font-bold text-gov-red uppercase"><!> Inactive</span>'),Ft=u('<tr><td class="px-5 py-3.5"><p class="font-bold text-text-primary text-sm"> </p> <p class="text-[11px] text-text-muted"> </p></td><td class="px-4 py-3.5"><p class="text-xs text-text-secondary"> </p> <p class="text-[10px] text-text-muted"> </p></td><td class="px-4 py-3.5 text-center"><span><!> </span></td><td class="px-4 py-3.5 text-center"><!></td><td class="px-5 py-3.5 text-right"><div class="flex items-center justify-end gap-2"><button class="px-3 py-1.5 text-[10px] font-bold text-gov-blue border border-gov-blue/20 rounded-lg hover:bg-gov-blue/5 transition-colors min-h-[32px]">Change Role</button> <button> </button></div></td></tr>'),Ht=u('<div class="p-12 text-center text-text-muted"><!> <p class="text-sm font-medium">No users match your search.</p></div>'),Pt=u('<div class="glass-card-static overflow-hidden"><div class="overflow-x-auto"><table class="w-full text-sm" aria-label="User management table"><thead><tr class="bg-gray-50/50 border-b border-gray-100 text-left"><th class="px-5 py-3 font-semibold text-text-muted text-xs uppercase tracking-wider">Name</th><th class="px-4 py-3 font-semibold text-text-muted text-xs uppercase tracking-wider">School</th><th class="px-4 py-3 font-semibold text-text-muted text-xs uppercase tracking-wider text-center">Role</th><th class="px-4 py-3 font-semibold text-text-muted text-xs uppercase tracking-wider text-center">Status</th><th class="px-5 py-3 font-semibold text-text-muted text-xs uppercase tracking-wider text-right">Actions</th></tr></thead><tbody class="divide-y divide-gray-50"></tbody></table></div> <!></div> <p class="text-xs text-text-muted mt-3 text-center"> </p>',1),Gt=u('<div id="users-panel" role="tabpanel" aria-labelledby="users-tab"><div class="flex items-center gap-3 mb-6"><div class="relative flex-1 max-w-md"><!> <input type="text" placeholder="Search by name, email, role, school..." class="w-full pl-10 pr-4 py-2.5 text-sm bg-white/60 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-gov-blue/20 min-h-[44px]" aria-label="Search users"/></div> <button class="p-2.5 rounded-xl bg-white/60 border border-gray-200 text-text-muted hover:text-gov-blue hover:border-gov-blue/30 transition-all min-h-[44px] min-w-[44px] flex items-center justify-center" aria-label="Refresh user list"><!></button></div> <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"></div> <!></div>'),Kt=u('<div role="alert"><span class="w-6 h-6 rounded-full bg-white flex items-center justify-center text-[10px] shadow-sm"> </span> </div>'),Vt=u("<option> </option>"),Wt=u(`<div class="p-3 bg-gov-gold/10 rounded-xl border border-gov-gold/20 text-xs text-text-secondary" role="alert"><strong class="text-gov-gold-dark">Warning:</strong> Changing role from <strong> </strong> to <strong> </strong> will update this
                        user's access permissions immediately.</div>`),Jt=u('<div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-6" role="dialog" aria-modal="true" aria-label="Change user role"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden"><div class="p-6 border-b border-gray-100"><h3 class="text-lg font-bold text-text-primary">Change User Role</h3> <p class="text-sm text-text-secondary mt-1">Update role for <strong> </strong></p></div> <div class="p-6 space-y-4"><div><label for="role-select" class="block text-xs font-bold text-text-muted uppercase tracking-widest mb-2"> </label> <select id="role-select" class="w-full px-4 py-3 text-sm bg-gray-50 border border-gray-200 rounded-xl font-bold focus:ring-2 focus:ring-gov-blue/20 outline-none min-h-[48px]"></select></div> <!></div> <div class="p-6 border-t border-gray-100 flex items-center justify-end gap-3"><button class="px-5 py-2.5 text-sm font-bold text-text-muted hover:text-text-primary transition-colors min-h-[44px]">Cancel</button> <button class="px-5 py-2.5 bg-gov-blue text-white rounded-xl text-sm font-bold hover:bg-gov-blue-dark active:scale-95 transition-all disabled:opacity-40 min-h-[44px]"> </button></div></div></div>'),Qt=u('<div class="max-w-5xl mx-auto" role="main" aria-label="Admin Configuration"><div class="mb-8"><h1 class="text-2xl font-bold text-text-primary uppercase tracking-tight flex items-center gap-2"><!> Admin Configuration</h1> <p class="text-text-secondary mt-1">Manage system parameters and user accounts.</p></div> <div class="flex gap-1 p-1 bg-gray-100 rounded-2xl mb-8 max-w-md" role="tablist" aria-label="Admin sections"><button role="tab" aria-controls="settings-panel"><!> System Parameters</button> <button role="tab" aria-controls="users-panel"><!> User Management</button></div> <!> <!> <!></div> <!>',1);function ca(Fe,He){gt(He,!0);const ke=()=>kt(St,"$profile",Pe),[Pe,Ge]=wt();let Se=T(se([])),$e=T(!0),D=T(!1),W=T(se({text:"",type:"success"})),L=T(se([])),Z=T(!0),ne=T(""),O=T("settings"),c=T(se({open:!1,user:null,newRole:""}));const Re=["Teacher","School Head","Master Teacher","District Supervisor"];mt(()=>{ke()?.role!=="District Supervisor"&&ke()?.role,Ce(),de().then(()=>{x($e,!1),x(Z,!1)});const r=V.channel("admin-profiles").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},()=>{de()}).subscribe(),s=V.channel("admin-settings").on("postgres_changes",{event:"*",schema:"public",table:"system_settings"},()=>{Ce()}).subscribe();return()=>{r.unsubscribe(),s.unsubscribe()}});async function Ce(){const{data:r}=await V.from("system_settings").select("*"),s=r||[];x(Se,[{key:"submission_window_days",value:"5",description:"Days after week end to allow on-time submissions"},{key:"maintenance_mode",value:"false",description:"Disable all uploads for system maintenance"},{key:"enforce_ocr",value:"true",description:"Prevent submission if OCR metadata mismatch"},{key:"max_upload_size_mb",value:"2",description:"Global file size limit for uploads (Hard Limit)"}].map(b=>s.find(h=>h.key===b.key)||b),!0)}async function Ae(r,s){x(D,!0);const{error:n}=await V.from("system_settings").upsert({key:r,value:s,updated_at:new Date().toISOString()});n?J("Failed to save setting","error"):J(`Setting "${r}" updated successfully`,"success"),x(D,!1)}async function de(){const{data:r,error:s}=await V.from("profiles").select(`
                id, full_name, email, role, is_active, created_at,
                schools:school_id ( name ),
                districts:district_id ( name )
            `).order("full_name",{ascending:!0});!s&&r&&x(L,r.map(n=>({...n,school_name:n.schools?.name||"—",district_name:n.districts?.name||"—",is_active:n.is_active!==!1})),!0)}function Ke(r){x(c,{open:!0,user:r,newRole:r.role},!0)}async function Ve(){if(!e(c).user||!e(c).newRole)return;x(D,!0);const{error:r}=await V.from("profiles").update({role:e(c).newRole}).eq("id",e(c).user.id);if(r)J(`Failed to update role: ${r.message}`,"error");else{J(`${e(c).user.full_name} promoted to ${e(c).newRole}`,"success");const s=e(L).findIndex(n=>n.id===e(c).user.id);s>=0&&(e(L)[s].role=e(c).newRole)}x(c,{open:!1,user:null,newRole:""},!0),x(D,!1)}async function We(r){x(D,!0);const s=!r.is_active,{error:n}=await V.from("profiles").update({is_active:s}).eq("id",r.id);if(n)J(`Failed to update user status: ${n.message}`,"error");else{const b=e(L).findIndex(C=>C.id===r.id);b>=0&&(e(L)[b].is_active=s),J(`${r.full_name} ${s?"activated":"deactivated"}`,"success")}x(D,!1)}const ce=we(()=>()=>{const r=e(ne).toLowerCase().trim();return r?e(L).filter(s=>s.full_name?.toLowerCase().includes(r)||s.email?.toLowerCase().includes(r)||s.role?.toLowerCase().includes(r)||s.school_name?.toLowerCase().includes(r)):e(L)});function J(r,s){x(W,{text:r,type:s},!0),setTimeout(()=>x(W,{text:"",type:"success"},!0),3e3)}function Je(r){switch(r){case"District Supervisor":return"bg-gov-blue/10 text-gov-blue";case"School Head":return"bg-gov-green/10 text-gov-green";case"Master Teacher":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-text-muted"}}var Ue=Qt();ht("wt9tlv",r=>{ft(()=>{_t.title="Admin Config — Smart E-VISION"})});var ve=oe(Ue),ue=a(ve),ze=a(ue),Qe=a(ze);qe(Qe,{size:24}),P(),t(ze),P(2),t(ue);var pe=o(ue,2),Q=a(pe),Xe=a(Q);qe(Xe,{size:16}),P(),t(Q);var ee=o(Q,2),Ye=a(ee);Be(Ye,{size:16}),P(),t(ee),t(pe);var De=o(pe,2);{var Ze=r=>{var s=Tt(),n=a(s);{var b=h=>{var S=Dt();X(S,20,()=>Array(3),re,(j,i)=>{var N=zt();v(j,N)}),t(S),v(h,S)},C=h=>{var S=Mt();X(S,21,()=>e(Se),re,(j,i,N)=>{var q=It(),I=a(q),m=a(I),y=a(m,!0);t(m);var $=o(m,2),w=a($,!0);t($),t(I);var f=o(I,2),B=a(f);{var k=d=>{var A=Lt(),g=oe(A),_=a(g);t(g);var l=o(g,2),F=a(l,!0);t(l),U(te=>{E(g,1,`w-14 h-8 rounded-full transition-all relative ${e(i).value==="true"?"bg-gov-blue":"bg-gray-200"}`),Y(g,"aria-label",`Toggle ${te??""}`),E(_,1,`absolute top-1 w-6 h-6 rounded-full bg-white transition-all ${e(i).value==="true"?"left-7":"left-1"}`),E(l,1,`text-sm font-bold ${e(i).value==="true"?"text-gov-blue":"text-text-muted"}`),p(F,e(i).value==="true"?"ENABLED":"DISABLED")},[()=>e(i).key.replace(/_/g," ")]),M("click",g,()=>{e(i).value=e(i).value==="true"?"false":"true",Ae(e(i).key,e(i).value)}),v(d,A)},R=d=>{var A=jt(),g=oe(A);Oe(g);var _=o(g,2);U(l=>{Y(g,"aria-label",`${l??""} value`),_.disabled=e(D)},[()=>e(i).key.replace(/_/g," ")]),Ne(g,()=>e(i).value,l=>e(i).value=l),M("click",_,()=>Ae(e(i).key,e(i).value)),v(d,A)};z(B,d=>{e(i).key==="maintenance_mode"||e(i).key==="enforce_ocr"?d(k):d(R,!1)})}t(f),t(q),U(d=>{p(y,d),p(w,e(i).description||"System-wide parameter governing platform behavior.")},[()=>e(i).key.replace(/_/g," ")]),G(1,q,()=>le,()=>({y:20,duration:400})),v(j,q)}),t(S),v(h,S)};z(n,h=>{e($e)?h(b):h(C,!1)})}t(s),G(1,s,()=>ie,()=>({duration:200})),v(r,s)};z(De,r=>{e(O)==="settings"&&r(Ze)})}var Le=o(De,2);{var et=r=>{var s=Gt(),n=a(s),b=a(n),C=a(b);At(C,{size:16,class:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"});var h=o(C,2);Oe(h),t(b);var S=o(b,2),j=a(S);{let m=we(()=>e(Z)?"animate-spin":"");Ut(j,{size:16,get class(){return e(m)}})}t(S),t(n);var i=o(n,2);X(i,21,()=>Re,re,(m,y,$)=>{var w=Et(),f=a(w),B=a(f,!0);t(f);var k=o(f,2),R=a(k,!0);t(k),t(w),U(d=>{p(B,d),p(R,e(y)==="District Supervisor"?"Supervisors":e(y)+"s")},[()=>e(L).filter(d=>d.role===e(y)).length]),G(1,w,()=>le,()=>({y:10,delay:$*50})),v(m,w)}),t(i);var N=o(i,2);{var q=m=>{var y=Nt();X(y,20,()=>Array(5),re,($,w)=>{var f=Ot();v($,f)}),t(y),v(m,y)},I=m=>{var y=Pt(),$=oe(y),w=a($),f=a(w),B=o(a(f));X(B,21,()=>e(ce)(),_=>_.id,(_,l)=>{var F=Ft(),te=a(F),xe=a(te),ot=a(xe,!0);t(xe);var je=o(xe,2),it=a(je,!0);t(je),t(te);var ge=o(te),me=a(ge),lt=a(me,!0);t(me);var Ie=o(me,2),nt=a(Ie,!0);t(Ie),t(ge);var be=o(ge),fe=a(be),Me=a(fe);$t(Me,{size:10});var dt=o(Me);t(fe),t(be);var _e=o(be),ct=a(_e);{var vt=H=>{var K=qt(),ye=a(K);Rt(ye,{size:12}),P(),t(K),v(H,K)},ut=H=>{var K=Bt(),ye=a(K);Ct(ye,{size:12}),P(),t(K),v(H,K)};z(ct,H=>{e(l).is_active?H(vt):H(ut,!1)})}t(_e);var Te=o(_e),Ee=a(Te),he=a(Ee),ae=o(he,2),pt=a(ae,!0);t(ae),t(Ee),t(Te),t(F),U(H=>{E(F,1,`hover:bg-white/40 transition-colors ${e(l).is_active?"":"opacity-50"}`),p(ot,e(l).full_name||"—"),p(it,e(l).email||"—"),p(lt,e(l).school_name),p(nt,e(l).district_name),E(fe,1,`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-black uppercase tracking-wider ${H??""}`),p(dt,` ${e(l).role??""}`),Y(he,"aria-label",`Change role for ${e(l).full_name??""}`),E(ae,1,`px-3 py-1.5 text-[10px] font-bold rounded-lg transition-colors min-h-[32px] ${e(l).is_active?"text-gov-red border border-gov-red/20 hover:bg-gov-red/5":"text-gov-green border border-gov-green/20 hover:bg-gov-green/5"}`),Y(ae,"aria-label",`${e(l).is_active?"Deactivate":"Activate"} ${e(l).full_name??""}`),p(pt,e(l).is_active?"Deactivate":"Activate")},[()=>Je(e(l).role)]),M("click",he,()=>Ke(e(l))),M("click",ae,()=>We(e(l))),v(_,F)}),t(B),t(f),t(w);var k=o(w,2);{var R=_=>{var l=Ht(),F=a(l);Be(F,{size:32,class:"mx-auto mb-3 opacity-30"}),P(2),t(l),v(_,l)},d=we(()=>e(ce)().length===0);z(k,_=>{e(d)&&_(R)})}t($);var A=o($,2),g=a(A);t(A),U(_=>p(g,`${_??""} of ${e(L).length??""} users shown`),[()=>e(ce)().length]),v(m,y)};z(N,m=>{e(Z)?m(q):m(I,!1)})}t(s),Ne(h,()=>e(ne),m=>x(ne,m)),M("click",S,()=>{x(Z,!0),de().then(()=>x(Z,!1))}),G(1,s,()=>ie,()=>({duration:200})),v(r,s)};z(Le,r=>{e(O)==="users"&&r(et)})}var tt=o(Le,2);{var at=r=>{var s=Kt(),n=a(s),b=a(n,!0);t(n);var C=o(n);t(s),U(()=>{E(s,1,`fixed bottom-24 right-8 px-6 py-4 rounded-2xl shadow-elevated border-l-4 ${e(W).type==="success"?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800"} flex items-center gap-3 font-bold text-sm z-50`),p(b,e(W).type==="success"?"OK":"!!"),p(C,` ${e(W).text??""}`)}),G(1,s,()=>le,()=>({x:50})),G(2,s,()=>ie),v(r,s)};z(tt,r=>{e(W).text&&r(at)})}t(ve);var rt=o(ve,2);{var st=r=>{var s=Jt(),n=a(s),b=a(n),C=o(a(b),2),h=o(a(C)),S=a(h,!0);t(h),t(C),t(b);var j=o(b,2),i=a(j),N=a(i),q=a(N);t(N);var I=o(N,2);X(I,21,()=>Re,re,(k,R)=>{var d=Vt(),A=a(d,!0);t(d);var g={};U(()=>{p(A,e(R)),g!==(g=e(R))&&(d.value=(d.__value=e(R))??"")}),v(k,d)}),t(I),t(i);var m=o(i,2);{var y=k=>{var R=Wt(),d=o(a(R),2),A=a(d,!0);t(d);var g=o(d,2),_=a(g,!0);t(g),P(),t(R),U(()=>{p(A,e(c).user?.role),p(_,e(c).newRole)}),v(k,R)};z(m,k=>{e(c).newRole!==e(c).user?.role&&k(y)})}t(j);var $=o(j,2),w=a($),f=o(w,2),B=a(f,!0);t(f),t($),t(n),t(s),U(()=>{p(S,e(c).user?.full_name),p(q,`Current: ${e(c).user?.role??""}`),f.disabled=e(D)||e(c).newRole===e(c).user?.role,p(B,e(D)?"Updating...":"Confirm Change")}),yt(I,()=>e(c).newRole,k=>e(c).newRole=k),M("click",w,()=>x(c,{open:!1,user:null,newRole:""},!0)),M("click",f,Ve),G(1,n,()=>le,()=>({y:30,duration:300})),G(3,s,()=>ie,()=>({duration:200})),v(r,s)};z(rt,r=>{e(c).open&&r(st)})}U(()=>{E(Q,1,`flex-1 flex items-center justify-center gap-2 py-2.5 px-4 rounded-xl text-sm font-bold transition-all ${e(O)==="settings"?"bg-white text-gov-blue shadow-sm":"text-text-muted hover:text-text-primary"}`),Y(Q,"aria-selected",e(O)==="settings"),E(ee,1,`flex-1 flex items-center justify-center gap-2 py-2.5 px-4 rounded-xl text-sm font-bold transition-all ${e(O)==="users"?"bg-white text-gov-blue shadow-sm":"text-text-muted hover:text-text-primary"}`),Y(ee,"aria-selected",e(O)==="users")}),M("click",Q,()=>x(O,"settings")),M("click",ee,()=>x(O,"users")),v(Fe,Ue),bt(),Ge()}xt(["click"]);export{ca as component};
