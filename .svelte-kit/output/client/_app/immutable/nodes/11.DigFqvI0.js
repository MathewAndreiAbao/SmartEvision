import{d as Xt,a as u,f as h,c as Yt,s as m,b as Zt}from"../chunks/zt7kUNSb.js";import{p as te,d as $,f as I,o as ee,j as ae,h as Ct,a as se,e as re,s as r,c as a,b as C,g as t,$ as oe,r as e,i as X,t as wt}from"../chunks/D02y27Ec.js";import{i as Y}from"../chunks/CyaklKEO.js";import{e as ot,i as lt}from"../chunks/CUJHGDU6.js";import{t as M,a as O,f as le}from"../chunks/Mk7LNAF3.js";import{h as de,s as U,a as Z}from"../chunks/DG2cR9Zm.js";import{a as ie,s as ne}from"../chunks/HxVFllSf.js";import{p as ce}from"../chunks/t4rw-3Qc.js";import{S as dt,C as ve}from"../chunks/7c_gSnqO.js";import{D as xe}from"../chunks/BHDpGXD2.js";import{calculateCompliance as tt,groupSubmissionsByWeek as It,getComplianceBgClass as kt,getComplianceClass as St}from"../chunks/rRhaEF5Q.js";var pe=h('<div class="glass-card-static p-8 animate-pulse"><div class="h-4 bg-gray-200 rounded w-24 mb-4"></div> <div class="h-10 bg-gray-200 rounded w-16"></div></div>'),ue=h('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>'),me=h('<div class="p-10 text-center text-text-muted">No schools found</div>'),ge=h('<button class="w-full flex items-center justify-between px-6 py-3 hover:bg-white/40 transition-colors text-left"><div class="flex items-center gap-3 min-w-0"><span></span> <div class="min-w-0"><p class="text-sm font-medium text-text-primary truncate"> </p> <p class="text-xs text-text-muted"> </p></div></div> <span> </span></button>'),fe=h('<div class="divide-y divide-gray-50 max-h-[400px] overflow-y-auto"></div>'),he=h('<div class="flex items-center justify-center h-[320px] text-text-muted"><p>No trend data available</p></div>'),be=h('<div class="p-10 text-center"><p class="text-text-muted font-medium">All teachers are at 70%+ compliance!</p></div>'),_e=h('<tr class="hover:bg-white/40 transition-colors"><td class="px-6 py-3 font-medium text-text-primary"> </td><td class="px-4 py-3 text-text-secondary text-xs"> </td><td class="px-4 py-3 text-center"><span> </span></td><td class="px-4 py-3 text-center text-gov-green font-semibold"> </td><td class="px-4 py-3 text-center text-gov-gold-dark font-semibold"> </td><td class="px-4 py-3 text-center text-gov-red font-semibold"> </td><td class="px-4 py-3 text-center"><span> </span></td></tr>'),ye=h('<div class="overflow-x-auto"><table class="w-full text-sm"><thead><tr class="border-b border-gray-100"><th class="px-6 py-3 text-left text-xs font-semibold text-text-muted uppercase">Teacher</th><th class="px-4 py-3 text-left text-xs font-semibold text-text-muted uppercase">School</th><th class="px-4 py-3 text-center text-xs font-semibold text-text-muted uppercase">Compliant</th><th class="px-4 py-3 text-center text-xs font-semibold text-text-muted uppercase">Late</th><th class="px-4 py-3 text-center text-xs font-semibold text-text-muted uppercase">Non-compliant</th><th class="px-4 py-3 text-center text-xs font-semibold text-text-muted uppercase">Risk</th></tr></thead><tbody class="divide-y divide-gray-50"></tbody></table></div>'),Ce=h('<div class="grid grid-cols-2 lg:grid-cols-4 gap-6 mb-10"><div><!></div> <div><!></div> <div><!></div> <div><!></div></div> <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8"><div class="glass-card-static overflow-hidden"><div class="px-6 py-4 border-b border-gray-100"><h3 class="text-lg font-bold text-text-primary">School Ranking</h3> <p class="text-xs text-text-muted mt-0.5">Sorted by compliance rate (lowest first)</p></div> <!></div> <div class="glass-card-static p-6"><h3 class="text-lg font-bold text-text-primary mb-4">Multi-School Trend</h3> <!></div></div> <div class="glass-card-static overflow-hidden"><div class="px-6 py-4 border-b border-gray-100"><h3 class="text-lg font-bold text-text-primary">Coaching Insights</h3> <p class="text-xs text-text-muted mt-0.5">Teachers with &lt;70% compliance needing support</p></div> <!></div>',1),we=h('<p class="text-center text-text-muted py-6">No teachers found</p>'),ke=h('<tr class="hover:bg-white/30 transition-colors"><td class="px-4 py-2 font-medium text-text-primary"> </td><td class="px-3 py-2 text-center text-gov-green font-semibold"> </td><td class="px-3 py-2 text-center text-gov-gold-dark font-semibold"> </td><td class="px-3 py-2 text-center text-gov-red font-semibold"> </td><td class="px-3 py-2 text-center"><span> </span></td></tr>'),Se=h('<div class="overflow-x-auto"><table class="w-full text-sm"><thead><tr class="border-b border-gray-100"><th class="px-4 py-2 text-left text-xs font-semibold text-text-muted">Teacher</th><th class="px-3 py-2 text-center text-xs font-semibold text-text-muted">Compliant</th><th class="px-3 py-2 text-center text-xs font-semibold text-text-muted">Late</th><th class="px-3 py-2 text-center text-xs font-semibold text-text-muted">Non-compliant</th><th class="px-3 py-2 text-center text-xs font-semibold text-text-muted">Rate</th></tr></thead><tbody class="divide-y divide-gray-50"></tbody></table></div>'),Te=h('<div><div class="mb-10"><h1 class="text-3xl font-black text-text-primary tracking-tight">Coaching Hub</h1> <p class="text-base text-text-secondary mt-1">Monitor performance, identify gaps, and drive institutional improvement</p></div> <!></div> <!>',1);function Pe(Mt,Et){te(Et,!0);const Ht=()=>ne(ce,"$profile",jt),[jt,Pt]=ie();let et=$(I([])),w=$(I([])),R=$(I([])),Tt=$(!0),it,L=I({schoolCount:0,overallRate:0,strugglingTeachers:0,totalTeachers:0});const at=X(()=>()=>t(et).map(s=>{const d=t(w).filter(n=>n.school_id===s.id),l=new Set(d.map(n=>n.id)),c=d.reduce((n,g)=>n+(g.loadCount||0),0),x=t(R).filter(n=>l.has(n.user_id)),y=tt(x,c);return{...s,...y,teacherCount:l.size}}).sort((s,d)=>s.rate-d.rate)),$t=X(()=>()=>t(w).map(s=>{const d=t(R).filter(x=>x.user_id===s.id),l=tt(d,s.loadCount),c=t(et).find(x=>x.id===s.school_id);return{...s,...l,schoolName:c?.name||"Unknown"}}).filter(s=>s.expected>0&&s.rate<70).sort((s,d)=>s.rate-d.rate));let nt=$(I([])),Rt=$(I([])),ct=$(!1),Lt=$(""),vt=$(I([]));ee(async()=>{await Dt(),C(Tt,!1),Ot()}),ae(()=>{it&&U.removeChannel(it)});function Ot(){it=U.channel("master-teacher-dashboard").on("postgres_changes",{event:"*",schema:"public",table:"submissions"},()=>{Dt()}).subscribe()}async function Dt(){if(!Ht())return;const[d,l,c,x]=await Promise.all([U.from("schools").select("id, name").order("name"),U.from("profiles").select("id, full_name, role, school_id").eq("role","Teacher").order("full_name"),U.from("submissions").select("id, user_id, status, compliance_status, created_at, week_number").order("created_at",{ascending:!1}),U.from("teaching_loads").select("id, user_id, profiles!inner(school_id)")]);C(et,d.data||[],!0),C(w,l.data||[],!0),C(R,c.data||[],!0);const y=x.data||[];C(w,t(w).map(o=>({...o,loadCount:y.filter(v=>v.user_id===o.id).length})),!0);const n=t(w).reduce((o,v)=>o+(v.loadCount||0),0),g=tt(t(R),n);L.schoolCount=t(et).length,L.overallRate=g.rate,L.totalTeachers=t(w).length,L.strugglingTeachers=t(w).filter(o=>{const v=t(R).filter(T=>T.user_id===o.id);return tt(v,o.loadCount).rate<70&&v.length>0}).length;const D=It(t(R),8);C(nt,D.map(o=>o.label),!0);const S=[{label:"All Schools",data:D.map(o=>o.rate),color:"#0038A8"},{label:"80% Target",data:D.map(()=>80),color:"#CE1126",dashed:!0}],B=[...t(at)()||[]].sort((o,v)=>v.rate-o.rate).slice(0,3),b=["#008751","#FCD116","#9966CC"];B.forEach((o,v)=>{const E=new Set(t(w).filter(p=>p.school_id===o.id).map(p=>p.id)),T=t(R).filter(p=>E.has(p.user_id)),W=It(T,8);S.push({label:o.name?.replace(" Elementary School"," ES")||"School",data:W.map(p=>p.rate),color:b[v]})}),C(Rt,S,!0)}function Ut(s){const d=t(w).filter(l=>l.school_id===s.id);C(Lt,`${s.name} — Teachers`),C(vt,d.map(l=>{const c=t(R).filter(y=>y.user_id===l.id),x=tt(c,l.loadCount);return{...l,...x}}).sort((l,c)=>l.rate-c.rate),!0),C(ct,!0)}function Bt(s){return s<30?{label:"HIGH",class:"bg-gov-red/15 text-gov-red"}:s<50?{label:"MEDIUM",class:"bg-gov-gold/15 text-gov-gold-dark"}:{label:"LOW",class:"bg-gov-green/15 text-gov-green"}}var Nt=Te();de("b7htdt",s=>{re(()=>{oe.title="Coaching Hub — Smart E-VISION"})});var xt=Ct(Nt),Wt=r(a(xt),2);{var qt=s=>{var d=ue();ot(d,20,()=>Array(4),lt,(l,c)=>{var x=pe();u(l,x)}),e(d),u(s,d)},zt=s=>{var d=Ce(),l=Ct(d),c=a(l),x=a(c);dt(x,{icon:"School",get value(){return L.schoolCount},label:"Schools supervised"}),e(c);var y=r(c,2),n=a(y);dt(n,{icon:"Users",get value(){return L.totalTeachers},label:"Total Teachers",color:"from-gov-blue to-gov-blue-dark"}),e(y);var g=r(y,2),D=a(g);dt(D,{icon:"Activity",get value(){return`${L.overallRate??""}%`},label:"Aggregate Rate",color:"from-gov-green to-gov-green-dark"}),e(g);var S=r(g,2),B=a(S);dt(B,{icon:"HeartHandshake",get value(){return L.strugglingTeachers},label:"Coaching Leads",color:"from-gov-red to-red-700"}),e(S),e(l);var b=r(l,2),o=a(b),v=r(a(o),2);{var E=i=>{var _=me();u(i,_)},T=X(()=>t(at)().length===0),W=i=>{var _=fe();ot(_,21,()=>t(at)(),lt,(st,k,F)=>{var f=ge(),j=a(f),N=a(j);N.textContent=F+1;var P=r(N,2),G=a(P),V=a(G,!0);e(G);var rt=r(G,2),J=a(rt);e(rt),e(P),e(j);var A=r(j,2),ht=a(A);e(A),e(f),wt((K,bt,Q)=>{Z(N,1,`w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold ${K??""}`),m(V,t(k).name),m(J,`${t(k).teacherCount??""} teachers · ${t(k).total??""}
                      submissions`),Z(A,1,`inline-block px-2.5 py-1 rounded-full text-xs font-bold flex-shrink-0 ${bt??""} ${Q??""}`),m(ht,`${t(k).rate??""}%`)},[()=>F<3?"bg-gov-red/15 text-gov-red":F>=t(at)().length-3?"bg-gov-green/15 text-gov-green":"bg-gray-100 text-text-muted",()=>kt(t(k).rate),()=>St(t(k).rate)]),Zt("click",f,()=>Ut(t(k))),u(st,f)}),e(_),u(i,_)};Y(v,i=>{t(T)?i(E):i(W,!1)})}e(o);var p=r(o,2),pt=r(a(p),2);{var q=i=>{ve(i,{get labels(){return t(nt)},get datasets(){return t(Rt)},height:320})},ut=i=>{var _=he();u(i,_)};Y(pt,i=>{t(nt).length>0?i(q):i(ut,!1)})}e(p),e(b);var H=r(b,2),z=r(a(H),2);{var mt=i=>{var _=be();u(i,_)},gt=X(()=>t($t)().length===0),ft=i=>{var _=ye(),st=a(_),k=r(a(st));ot(k,21,()=>t($t)(),lt,(F,f)=>{const j=X(()=>Bt(t(f).rate));var N=_e(),P=a(N),G=a(P,!0);e(P);var V=r(P),rt=a(V,!0);e(V);var J=r(V),A=a(J),ht=a(A);e(A),e(J);var K=r(J),bt=a(K,!0);e(K);var Q=r(K),Gt=a(Q,!0);e(Q);var _t=r(Q),Vt=a(_t,!0);e(_t);var At=r(_t),yt=a(At),Jt=a(yt,!0);e(yt),e(At),e(N),wt((Kt,Qt)=>{m(G,t(f).full_name),m(rt,t(f).schoolName),Z(A,1,`inline-block px-2.5 py-1 rounded-full text-xs font-bold ${Kt??""} ${Qt??""}`),m(ht,`${t(f).rate??""}%`),m(bt,t(f).Compliant),m(Gt,t(f).Late),m(Vt,t(f).NonCompliant),Z(yt,1,`inline-block px-2 py-1 rounded-full text-xs font-bold ${t(j).class??""}`),m(Jt,t(j).label)},[()=>kt(t(f).rate),()=>St(t(f).rate)]),u(F,N)}),e(k),e(st),e(_),u(i,_)};Y(z,i=>{t(gt)?i(mt):i(ft,!1)})}e(H),M(1,c,()=>O,()=>({y:20,duration:400})),M(1,y,()=>O,()=>({y:20,duration:400,delay:100})),M(1,g,()=>O,()=>({y:20,duration:400,delay:200})),M(1,S,()=>O,()=>({y:20,duration:400,delay:300})),M(1,o,()=>O,()=>({y:20,duration:500,delay:400})),M(1,p,()=>O,()=>({y:20,duration:500,delay:500})),M(1,H,()=>le,()=>({duration:500,delay:600})),u(s,d)};Y(Wt,s=>{t(Tt)?s(qt):s(zt,!1)})}e(xt);var Ft=r(xt,2);xe(Ft,{get isOpen(){return t(ct)},get title(){return t(Lt)},onClose:()=>{C(ct,!1)},children:(s,d)=>{var l=Yt(),c=Ct(l);{var x=n=>{var g=we();u(n,g)},y=n=>{var g=Se(),D=a(g),S=r(a(D));ot(S,21,()=>t(vt),lt,(B,b)=>{var o=ke(),v=a(o),E=a(v,!0);e(v);var T=r(v),W=a(T,!0);e(T);var p=r(T),pt=a(p,!0);e(p);var q=r(p),ut=a(q,!0);e(q);var H=r(q),z=a(H),mt=a(z);e(z),e(H),e(o),wt((gt,ft)=>{m(E,t(b).full_name),m(W,t(b).Compliant),m(pt,t(b).Late),m(ut,t(b).NonCompliant),Z(z,1,`inline-block px-2 py-0.5 rounded-full text-xs font-bold ${gt??""} ${ft??""}`),m(mt,`${t(b).rate??""}%`)},[()=>kt(t(b).rate),()=>St(t(b).rate)]),u(B,o)}),e(S),e(D),e(g),u(n,g)};Y(c,n=>{t(vt).length===0?n(x):n(y,!1)})}u(s,l)},$$slots:{default:!0}}),u(Mt,Nt),se(),Pt()}Xt(["click"]);export{Pe as component};
