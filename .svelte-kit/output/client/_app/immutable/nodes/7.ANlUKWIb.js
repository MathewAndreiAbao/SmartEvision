import{_ as De}from"../chunks/PPVm8Dsz.js";import{a as K,f as U,s as pe}from"../chunks/zt7kUNSb.js";import{p as We,f as Q,d as I,o as $e,j as Te,a as je,e as ze,s as p,c as e,b as L,m as me,g,$ as Ee,r as t,n as k,h as Ie,t as Le}from"../chunks/D02y27Ec.js";import{s as O,C as Oe,A as Pe,T as Me,Z as Xe}from"../chunks/Dfy_UmCS.js";import{i as Ye}from"../chunks/CyaklKEO.js";import{t as D,f as Ze,a as P}from"../chunks/Mk7LNAF3.js";import{h as Ne,s as x,a as Fe}from"../chunks/DG2cR9Zm.js";import{b as ve}from"../chunks/DtsVQfy1.js";import{a as Ge,s as He}from"../chunks/HxVFllSf.js";import{p as Ve}from"../chunks/t4rw-3Qc.js";import{getSubmissionWeek as qe,calculateCompliance as ue}from"../chunks/rRhaEF5Q.js";import{R as Be}from"../chunks/EVh9RYOs.js";import{D as Je}from"../chunks/Bm8XeIEY.js";import{T as Ke}from"../chunks/DVHe6b_l.js";function Qe(W,N=8){if(!W||W.length<2)return{riskScore:0,label:"On-Track",trend:"Stable",message:"Insufficent data for predictive modeling."};const $=[...W].sort((l,z)=>z.week_number-l.week_number).slice(0,N).reverse().map((l,z)=>({x:z,y:l.compliance_status==="compliant"?0:l.compliance_status==="late"?1:2})),h=$.length;if(h<2)return{riskScore:0,label:"On-Track",trend:"Stable",message:"Steady state."};let y=0,_=0,w=0,T=0;for(const l of $)y+=l.x,_+=l.y,w+=l.x*l.y,T+=l.x*l.x;const f=(h*w-y*_)/(h*T-y*y),j=_/h,m=$[h-1].y;let c=j*20+m*20+f*30,u=Math.min(100,Math.max(0,Math.round(c*20))),v="On-Track";u>70?v="Critical":u>35&&(v="At-Risk");let C="Stable";f>.1?C="Declining":f<-.1&&(C="Improving");let S="Maintaining consistent submission patterns.";return v==="Critical"?S="Highly likely to miss or delay next week's submission based on recent breakdown.":v==="At-Risk"?S="Compliance consistency is wavering; monitor next week closely.":C==="Improving"&&(S="Compliance habits are showing positive momentum."),{riskScore:u,label:v,trend:C,message:S}}var Ue=U('<div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="glass-card-static h-96 animate-pulse"></div> <div class="glass-card-static h-96 animate-pulse"></div></div>'),et=U('<div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="glass-card-static p-8"><div class="flex items-center justify-between mb-8"><div class="flex items-center gap-3"><div class="p-2 rounded-lg bg-gov-blue/10 text-gov-blue"><!></div> <h3 class="text-sm font-black text-text-primary uppercase tracking-widest">Global Trend</h3></div> <div class="px-3 py-1 bg-gov-green/10 text-gov-green rounded-full text-[10px] font-black uppercase tracking-widest">8-Week Window</div></div> <div class="h-72"><canvas></canvas></div></div> <div class="glass-card-static p-8"><div class="flex items-center justify-between mb-8"><div class="flex items-center gap-3"><div class="p-2 rounded-lg bg-gov-blue/10 text-gov-blue"><!></div> <h3 class="text-sm font-black text-text-primary uppercase tracking-widest">School Comparison</h3></div></div> <div class="h-72"><canvas></canvas></div></div></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-10"><div class="glass-card-static p-8 text-center group"><div class="w-16 h-16 rounded-2xl bg-gov-blue/5 text-gov-blue flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-500"><!></div> <p class="text-4xl font-black text-gov-blue tracking-tighter"> </p> <p class="text-xs font-bold text-text-muted mt-2 uppercase tracking-widest">Growth Since Week 1</p></div> <div class="glass-card-static p-8 text-center group"><div class="w-16 h-16 rounded-2xl bg-gov-green/5 text-gov-green flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-500"><!></div> <p class="text-4xl font-black text-gov-green tracking-tighter">80%</p> <p class="text-xs font-bold text-text-muted mt-2 uppercase tracking-widest">Operational Target</p></div> <div class="glass-card-static p-8 text-center group"><div class="w-16 h-16 rounded-2xl bg-gov-gold/5 text-gov-gold flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-500"><!></div> <div class="flex items-center justify-center gap-2 mb-1"><p> </p></div> <p class="text-[10px] font-black uppercase tracking-widest text-text-muted opacity-50">Predictive Compliance Forecast</p></div></div>',1),tt=U(`<div><div class="mb-10 flex items-start justify-between"><div><h1 class="text-3xl font-black text-text-primary tracking-tight">Institutional Analytics</h1> <p class="text-base text-text-secondary mt-1 font-medium">Longitudinal performance tracking and predictive compliance
                modeling</p></div> <div class="flex items-center gap-3"><button class="p-2.5 rounded-xl bg-surface-muted text-text-secondary hover:text-gov-blue transition-colors border border-border-subtle shadow-sm"><!></button> <button class="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-gov-blue text-white text-sm font-bold shadow-lg shadow-gov-blue/20 hover:bg-gov-blue-dark transition-all"><!> Export Data</button></div></div> <!></div>`);function ft(W,N){We(N,!0);const $=()=>He(Ve,"$profile",h),[h,y]=Ge();let _=I(void 0),w=I(void 0),T=I(!0),f=null,j,m=null,c=null,u=Q({currentCompliance:0,improvement:0,topSchools:0}),v=I(Q({riskScore:0,label:"On-Track",trend:"Stable",message:"Calculating predictive model..."}));$e(async()=>{const{Chart:r,registerables:s}=await De(async()=>{const{Chart:a,registerables:o}=await import("../chunks/BcLaVOC9.js");return{Chart:a,registerables:o}},[],import.meta.url);r.register(...s),f=r;const{weeklyData:n,schoolData:i}=await l();L(T,!1),await me(),te(n,i),C()}),Te(()=>{j&&x.removeChannel(j),m&&m.destroy(),c&&c.destroy()});function C(){j=x.channel("analytics-dashboard").on("postgres_changes",{event:"*",schema:"public",table:"submissions"},async()=>{const{weeklyData:r,schoolData:s}=await l();S(r,s)}).subscribe()}async function S(r,s){if(!m||!c){await me(),te(r,s);return}const n=O(r),i=O(s);m.data.datasets[0].data=n,m.update(),c.data.labels=i.map(a=>a.name),c.data.datasets[0].data=i.map(a=>a.compliant),c.data.datasets[1].data=i.map(a=>a.late),c.data.datasets[2].data=i.map(a=>a.nonCompliant),c.update()}async function l(){if(!$())return{weeklyData:[],schoolData:[]};const s=await z(),n=await ge();u.currentCompliance=s[s.length-1]||0,u.improvement=s[0]?u.currentCompliance-s[0]:0,u.topSchools=n.filter(a=>a.rate>=80).length;const{data:i}=await x.from("submissions").select("week_number, compliance_status").order("week_number",{ascending:!0});return L(v,Qe(i||[]),!0),{weeklyData:s,schoolData:n}}async function z(){const[r,s]=await Promise.all([x.from("submissions").select("compliance_status, week_number, created_at"),x.from("academic_calendar").select("week_number").eq("school_year","2025-2026").order("week_number",{ascending:!0})]),n=r.data||[],i=s.data||[],a=i.length>0?i.map(o=>o.week_number):[1,2,3,4,5,6,7,8];return L(ee,a.map(o=>`Week ${o}`),!0),a.map(o=>{const b=n.filter(R=>qe(R)===o);return ue(b).rate})}async function ge(){const[r,s,n]=await Promise.all([x.from("schools").select("id, name"),x.from("submissions").select("compliance_status, uploader:profiles!inner(school_id)"),x.from("teaching_loads").select("id, profiles!inner(school_id)")]),i=r.data||[],a=s.data||[],o=n.data||[];return i.map(b=>{const X=a.filter(d=>(Array.isArray(d.uploader)?d.uploader[0]:d.uploader)?.school_id===b.id),R=o.filter(d=>(Array.isArray(d.profiles)?d.profiles[0]:d.profiles)?.school_id===b.id).length,A=ue(X,R);return{name:b.name.replace(" Elementary School"," ES"),compliant:A.Compliant,late:A.Late,nonCompliant:A.NonCompliant,rate:A.rate}})}let ee=I(Q([]));function te(r,s){if(!f)return;m&&m.destroy(),c&&c.destroy();const n=O(g(ee)),i=O(r),a=O(s);m=new f(g(_),{type:"line",data:{labels:n,datasets:[{label:"Compliance Rate (%)",data:i,borderColor:"#0038A8",backgroundColor:"rgba(0, 56, 168, 0.1)",fill:!0,tension:.4,pointRadius:5,pointHoverRadius:8}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:o=>o+"%"}}}}}),c=new f(g(w),{type:"bar",data:{labels:a.map(o=>o.name),datasets:[{label:"Compliant",data:a.map(o=>o.compliant),backgroundColor:"#008751"},{label:"Late",data:a.map(o=>o.late),backgroundColor:"#FCD116"},{label:"Non-compliant",data:a.map(o=>o.nonCompliant),backgroundColor:"#CE1126"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0}}}})}var M=tt();Ne("1d0h3tk",r=>{ze(()=>{Ee.title="Analytics â€” Smart E-VISION"})});var F=e(M),ae=p(e(F),2),G=e(ae),fe=e(G);Be(fe,{size:18}),t(G);var se=p(G,2),be=e(se);Je(be,{size:18}),k(),t(se),t(ae),t(F);var xe=p(F,2);{var he=r=>{var s=Ue();K(r,s)},_e=r=>{var s=et(),n=Ie(s),i=e(n),a=e(i),o=e(a),b=e(o),X=e(b);Ke(X,{size:20}),t(b),k(2),t(o),k(2),t(a);var R=p(a,2),A=e(R);ve(A,J=>L(_,J),()=>g(_)),t(R),t(i);var d=p(i,2),E=e(d),re=e(E),oe=e(re),ke=e(oe);Oe(ke,{size:20}),t(oe),k(2),t(re),t(E);var ie=p(E,2),ye=e(ie);ve(ye,J=>L(w,J),()=>g(w)),t(ie),t(d),t(n);var ne=p(n,2),Y=e(ne),H=e(Y),we=e(H);Pe(we,{size:32,strokeWidth:1.5}),t(H);var le=p(H,2),Ce=e(le);t(le),k(2),t(Y);var Z=p(Y,2),ce=e(Z),Se=e(ce);Me(Se,{size:32,strokeWidth:1.5}),t(ce),k(4),t(Z);var V=p(Z,2),q=e(V),Re=e(q);Xe(Re,{size:32,strokeWidth:1.5}),t(q);var de=p(q,2),B=e(de),Ae=e(B);t(B),t(de),k(2),t(V),t(ne),Le(()=>{pe(Ce,`+${u.improvement??""}%`),Fe(B,1,`text-4xl font-black tracking-tighter ${g(v).label==="Critical"?"text-gov-red":g(v).label==="At-Risk"?"text-gov-gold-dark":"text-gov-green"}`),pe(Ae,`${g(v).riskScore??""}%`)}),D(1,i,()=>P,()=>({y:20,duration:600})),D(1,d,()=>P,()=>({y:20,duration:600,delay:200})),D(1,Y,()=>P,()=>({y:20,duration:600,delay:400})),D(1,Z,()=>P,()=>({y:20,duration:600,delay:500})),D(1,V,()=>P,()=>({y:20,duration:600,delay:600})),K(r,s)};Ye(xe,r=>{g(T)?r(he):r(_e,!1)})}t(M),D(1,M,()=>Ze,()=>({duration:400})),K(W,M),je(),y()}export{ft as component};
