import{d as Ye,a as m,s as h,f as g,b as A,t as Ze}from"../chunks/zt7kUNSb.js";import{p as et,d as F,f as E,o as tt,t as S,g as o,a as rt,e as ot,s as d,c as i,b as k,$ as at,r as s,i as N,h as st,n as it}from"../chunks/D02y27Ec.js";import{i as T}from"../chunks/CyaklKEO.js";import{e as H,i as fe}from"../chunks/CUJHGDU6.js";import{c as nt}from"../chunks/BcSwuURU.js";import{t as B,a as pe,f as Z}from"../chunks/Mk7LNAF3.js";import{h as lt,s as z,r as dt,a as ve,b as me}from"../chunks/DG2cR9Zm.js";import{b as ct}from"../chunks/7bhswH3j.js";import{a as ut,s as ft}from"../chunks/HxVFllSf.js";import{p as pt}from"../chunks/t4rw-3Qc.js";import{S as vt}from"../chunks/BlBMRgHN.js";import{normalizeComplianceStatus as mt}from"../chunks/rRhaEF5Q.js";import{S as gt}from"../chunks/C5CMo2Ol.js";import{A as _t,H as ht,F as xt,E as bt,a as yt,U as wt,S as kt}from"../chunks/DnpnxaVV.js";import{C as St}from"../chunks/BTf-ztL-.js";import{F as Ct}from"../chunks/ChsElkNZ.js";import{D as $t}from"../chunks/Bm8XeIEY.js";import{C as Dt}from"../chunks/DB24PY1k.js";var Tt=g('<button class="p-2 rounded-lg hover:bg-gray-100 text-text-muted hover:text-text-primary transition-colors flex-shrink-0" title="Go back"><!></button>'),Ut=g('<span class="flex items-center gap-1.5"><!> Archive</span>'),Ft=g("<!> <button><!></button>",1),zt=g('<div class="glass-card-static p-6 animate-pulse"><div class="w-12 h-12 bg-gray-200 rounded-xl mx-auto mb-3"></div> <div class="h-3 bg-gray-200 rounded w-3/4 mx-auto mb-2"></div> <div class="h-2 bg-gray-100 rounded w-1/2 mx-auto"></div></div>'),Mt=g('<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>'),Lt=g('<button class="gov-card p-5 text-left cursor-pointer group"><div><!></div> <p class="text-sm font-semibold text-text-primary text-center truncate leading-tight"> </p> <p class="text-xs text-text-muted text-center mt-1.5"> </p></button>'),At=g('<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>'),Nt=g('<div class="text-center py-20"><div class="w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mx-auto mb-4"><!></div> <p class="text-lg font-semibold text-text-primary"> </p> <p class="text-sm text-text-muted mt-2"> </p></div>'),Bt=g("<span> </span>"),It=g("<span> </span>"),Pt=g('<span class="hidden sm:inline"> </span>'),jt=g('<div class="gov-card-static p-4 flex items-center gap-4 hover:bg-white/80 transition-colors group"><div class="w-10 h-10 rounded-xl bg-gradient-to-br from-gov-blue/10 to-gov-blue/5 flex items-center justify-center flex-shrink-0"><!></div> <div class="flex-1 min-w-0"><p class="text-sm font-semibold text-text-primary truncate"> </p> <div class="flex items-center gap-2 mt-1 text-xs text-text-muted flex-wrap"><span class="px-1.5 py-0.5 bg-gray-100 rounded font-medium text-text-secondary"> </span> <!> <!> <span> </span> <!></div></div> <div class="flex-shrink-0 hidden sm:block"><!></div> <div class="flex items-center gap-1 flex-shrink-0 opacity-60 group-hover:opacity-100 transition-opacity"><button class="p-2 text-text-muted hover:text-gov-blue hover:bg-gov-blue/10 rounded-lg transition-all" title="View"><!></button> <button class="p-2 text-text-muted hover:text-gov-blue hover:bg-gov-blue/10 rounded-lg transition-all" title="Download"><!></button></div></div>'),qt=g('<div class="space-y-2"><div class="flex items-center justify-between px-2 mb-3"><p class="text-xs text-text-muted font-semibold uppercase tracking-wider"> </p></div> <!></div>'),Et=g('<div><div class="mb-6"><h1 class="text-2xl font-bold text-text-primary">Document Archive</h1> <p class="text-base text-text-secondary mt-1"> </p></div> <div class="glass-card-static p-4 mb-6 flex flex-col sm:flex-row items-stretch sm:items-center gap-4"><div class="flex items-center gap-1 flex-1 min-w-0 overflow-x-auto"><!> <!></div> <div class="relative flex-shrink-0 w-full sm:w-64"><!> <input type="text" placeholder="Search files..." class="w-full pl-9 pr-4 py-2.5 text-sm bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-gov-blue/30 focus:border-gov-blue outline-none min-h-[44px]"/></div></div> <!></div>');function ir(ge,_e){et(_e,!0);const I=()=>ft(pt,"$profile",he),[he,xe]=ut();let U=F(E([])),P=F(E({})),M=F(E({})),ee=F(!0),$=F(""),x=F(E([{type:"root",id:"root",label:"Archive"}]));tt(async()=>{await be(),k(ee,!1)});async function be(){const e=I();if(!e)return;const r=e.role;if(r==="Teacher"){const{data:t}=await z.from("submissions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});k(U,t||[],!0)}else if(r==="Master Teacher"||r==="School Head"){if(!e.school_id)return;const{data:t}=await z.from("submissions").select("*, uploader:profiles!inner(full_name, school_id, district_id)").eq("profiles.school_id",e.school_id).order("created_at",{ascending:!1});k(U,(t||[]).map(n=>({...n,uploader:n.uploader})),!0);const a={};for(const n of o(U))n.user_id&&n.uploader?.full_name&&(a[n.user_id]=n.uploader.full_name);k(M,a,!0)}else if(r==="District Supervisor"){if(!e.district_id)return;const{data:t}=await z.from("schools").select("id, name").eq("district_id",e.district_id),a=t||[],n={};for(const f of a)n[f.id]=f.name;k(P,n,!0);const c=a.map(f=>f.id);if(c.length===0)return;const{data:u}=await z.from("submissions").select("*, uploader:profiles!inner(full_name, school_id, district_id)").in("profiles.school_id",c).order("created_at",{ascending:!1});k(U,(u||[]).map(f=>({...f,uploader:f.uploader,school_name:n[f.uploader?.school_id||""]||"Unknown School"})),!0);const l={};for(const f of o(U))f.user_id&&f.uploader?.full_name&&(l[f.user_id]=f.uploader.full_name);k(M,l,!0)}}function ye(e){k(x,[...o(x),e],!0)}function we(e){k(x,o(x).slice(0,e+1),!0)}function ke(){o(x).length>1&&k(x,o(x).slice(0,-1),!0)}const _=N(()=>{let e=o(U);for(const r of o(x))r.type==="docType"?e=e.filter(t=>t.doc_type===r.id):r.type==="school"?e=e.filter(t=>t.uploader?.school_id===r.id):r.type==="teacher"?e=e.filter(t=>t.user_id===r.id):r.type==="week"&&(e=e.filter(t=>String(t.week_number)===r.id));if(o($)){const r=o($).toLowerCase();e=e.filter(t=>t.file_name.toLowerCase().includes(r)||t.doc_type?.toLowerCase().includes(r)||t.uploader?.full_name?.toLowerCase().includes(r)||t.file_hash?.toLowerCase().includes(r))}return e}),j=N(()=>{const e=I()?.role,r=o(x).length;return e==="Teacher"?r===1?R(o(_)):[]:e==="Master Teacher"||e==="School Head"?r===1?te(o(_)):r===2?re(o(_)):r===3?R(o(_)):[]:e==="District Supervisor"?r===1?te(o(_)):r===2?Ce(o(_)):r===3?re(o(_)):r===4?R(o(_)):[]:[]}),Se=N(()=>o(j).length===0||o($)&&o(_).length>0&&o(j).length===0);function te(e){const r=new Map;for(const t of e){const a=t.doc_type||"Other";r.set(a,(r.get(a)||0)+1)}return Array.from(r.entries()).sort(([t],[a])=>t.localeCompare(a)).map(([t,a])=>({id:t,label:t,count:a,type:"docType"}))}function Ce(e){const r=new Map;for(const t of e){const a=t.uploader?.school_id;a&&r.set(a,(r.get(a)||0)+1)}return Array.from(r.entries()).sort(([t],[a])=>(o(P)[t]||t).localeCompare(o(P)[a]||a)).map(([t,a])=>({id:t,label:o(P)[t]||"Unknown School",count:a,type:"school"}))}function re(e){const r=new Map;for(const t of e)t.user_id&&r.set(t.user_id,(r.get(t.user_id)||0)+1);return Array.from(r.entries()).sort(([t],[a])=>(o(M)[t]||t).localeCompare(o(M)[a]||a)).map(([t,a])=>({id:t,label:o(M)[t]||"Unknown Teacher",count:a,type:"teacher"}))}function R(e){const r=new Map;for(const t of e){const a=t.week_number!=null?String(t.week_number):"Unassigned";r.set(a,(r.get(a)||0)+1)}return Array.from(r.entries()).sort(([t],[a])=>{const n=parseInt(t),c=parseInt(a);return isNaN(n)&&isNaN(c)?t.localeCompare(a):isNaN(n)?1:isNaN(c)?-1:n-c}).map(([t,a])=>({id:t,label:t==="Unassigned"?"Unassigned":`Week ${t}`,count:a,type:"week"}))}function $e(e){return new Date(e).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"})}function De(e){return e?e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB":"—"}async function Te(e){const{data:r,error:t}=await z.storage.from("submissions").createSignedUrl(e,3600);return t?(console.error("Error getting signed URL:",t),null):r.signedUrl}async function Ue(e){const r=e.file_path||`${e.id}/${e.file_name}`,t=await Te(r);t?window.open(t,"_blank"):alert("Could not retrieve file. Please try again.")}async function Fe(e){const r=e.file_path||`${e.id}/${e.file_name}`,{data:t,error:a}=await z.storage.from("submissions").download(r);if(a){console.error("Download error:",a),alert("Download failed.");return}const n=URL.createObjectURL(t),c=document.createElement("a");c.href=n,c.download=e.file_name,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(n)}function ze(e){switch(e){case"docType":return"from-gov-blue/15 to-gov-blue/5 text-gov-blue";case"school":return"from-gov-green/15 to-gov-green/5 text-gov-green";case"teacher":return"from-gov-gold/15 to-gov-gold/5 text-gov-gold-dark";case"week":return"from-indigo-100 to-indigo-50 text-indigo-600";default:return"from-gray-100 to-gray-50 text-gray-600"}}function Me(e){switch(e){case"school":return kt;case"teacher":return wt;case"week":return Dt;default:return yt}}function Le(){const e=I()?.role;return e==="Teacher"?"Browse and search your archived instructional records":e==="District Supervisor"?"Browse all archived documents across your district":"Browse all archived documents in your school"}var O=Et();lt("15mknmq",e=>{ot(()=>{at.title="Archive — Smart E-VISION"})});var V=i(O),oe=d(i(V),2),Ae=i(oe,!0);s(oe),s(V);var W=d(V,2),G=i(W),ae=i(G);{var Ne=e=>{var r=Tt(),t=i(r);_t(t,{size:18}),s(r),A("click",r,ke),m(e,r)};T(ae,e=>{o(x).length>1&&e(Ne)})}var Be=d(ae,2);H(Be,17,()=>o(x),fe,(e,r,t)=>{var a=Ft(),n=st(a);{var c=v=>{St(v,{size:14,class:"text-text-muted flex-shrink-0 mx-0.5"})};T(n,v=>{t>0&&v(c)})}var u=d(n,2),l=i(u);{var f=v=>{var y=Ut(),D=i(y);ht(D,{size:14}),it(),s(y),m(v,y)},b=v=>{var y=Ze();S(()=>h(y,o(r).label)),m(v,y)};T(l,v=>{t===0?v(f):v(b,!1)})}s(u),S(()=>ve(u,1,`text-sm font-medium px-2 py-1 rounded-md transition-colors whitespace-nowrap flex-shrink-0
                        ${t===o(x).length-1?"text-gov-blue bg-gov-blue/5 font-bold":"text-text-muted hover:text-text-primary hover:bg-gray-100"}`)),A("click",u,()=>we(t)),m(e,a)}),s(G);var se=d(G,2),ie=i(se);gt(ie,{size:16,class:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"});var ne=d(ie,2);dt(ne),s(se),s(W);var Ie=d(W,2);{var Pe=e=>{var r=Mt();H(r,20,()=>Array(10),fe,(t,a)=>{var n=zt();m(t,n)}),s(r),m(e,r)},je=e=>{var r=At();H(r,23,()=>o(j),t=>t.id,(t,a,n)=>{const c=N(()=>Me(o(a).type));var u=Lt(),l=i(u),f=i(l);nt(f,()=>o(c),(C,K)=>{K(C,{size:22})}),s(l);var b=d(l,2),v=i(b,!0);s(b);var y=d(b,2),D=i(y);s(y),s(u),S(C=>{ve(l,1,`w-12 h-12 rounded-xl bg-gradient-to-br ${C??""} flex items-center justify-center mb-3 mx-auto group-hover:scale-110 transition-transform duration-200`),me(b,"title",o(a).label),h(v,o(a).label),h(D,`${o(a).count??""}
                        ${o(a).count===1?"file":"files"}`)},[()=>ze(o(a).type)]),A("click",u,()=>ye({type:o(a).type,id:o(a).id,label:o(a).label})),B(1,u,()=>pe,()=>({y:20,duration:300,delay:o(n)*40})),m(t,u)}),s(r),B(1,r,()=>Z,()=>({duration:200})),m(e,r)},qe=e=>{var r=Nt(),t=i(r),a=i(t);xt(a,{size:28,class:"text-text-muted"}),s(t);var n=d(t,2),c=i(n,!0);s(n);var u=d(n,2),l=i(u,!0);s(u),s(r),S(()=>{h(c,o($)?"No matching files":"This folder is empty"),h(l,o($)?"Try a different search term":"No documents have been uploaded yet")}),B(1,r,()=>Z,()=>({duration:300})),m(e,r)},Ee=e=>{var r=qt(),t=i(r),a=i(t),n=i(a);s(a),s(t);var c=d(t,2);H(c,19,()=>o(_),u=>u.id,(u,l,f)=>{var b=jt(),v=i(b),y=i(v);Ct(y,{size:18,class:"text-gov-blue"}),s(v);var D=d(v,2),C=i(D),K=i(C,!0);s(C);var le=d(C,2),Q=i(le),He=i(Q,!0);s(Q);var de=d(Q,2);{var Re=p=>{var w=Bt(),L=i(w);s(w),S(()=>h(L,`Week ${o(l).week_number??""}`)),m(p,w)};T(de,p=>{o(l).week_number!=null&&p(Re)})}var ce=d(de,2);{var Oe=p=>{var w=It(),L=i(w);s(w),S(()=>h(L,`• ${o(l).uploader.full_name??""}`)),m(p,w)};T(ce,p=>{o(l).uploader?.full_name&&I()?.role!=="Teacher"&&p(Oe)})}var J=d(ce,2),Ve=i(J);s(J);var We=d(J,2);{var Ge=p=>{var w=Pt(),L=i(w);s(w),S(Xe=>h(L,`• ${Xe??""}`),[()=>De(o(l).file_size)]),m(p,w)};T(We,p=>{o(l).file_size&&p(Ge)})}s(le),s(D);var X=d(D,2),Ke=i(X);{let p=N(()=>mt(o(l).compliance_status));vt(Ke,{get status(){return o(p)},size:"sm"})}s(X);var ue=d(X,2),q=i(ue),Qe=i(q);bt(Qe,{size:16}),s(q);var Y=d(q,2),Je=i(Y);$t(Je,{size:16}),s(Y),s(ue),s(b),S(p=>{me(C,"title",o(l).file_name),h(K,o(l).file_name),h(He,o(l).doc_type),h(Ve,`• ${p??""}`)},[()=>$e(o(l).created_at)]),A("click",q,p=>{p.stopPropagation(),Ue(o(l))}),A("click",Y,p=>{p.stopPropagation(),Fe(o(l))}),B(1,b,()=>pe,()=>({y:12,duration:250,delay:o(f)*30})),m(u,b)}),s(r),S(()=>h(n,`${o(_).length??""}
                    ${o(_).length===1?"file":"files"}`)),B(1,r,()=>Z,()=>({duration:200})),m(e,r)};T(Ie,e=>{o(ee)?e(Pe):!o(Se)&&o(j).length>0?e(je,1):o(_).length===0?e(qe,2):e(Ee,!1)})}s(O),S(e=>h(Ae,e),[Le]),ct(ne,()=>o($),e=>k($,e)),m(ge,O),rt(),xe()}Ye(["click"]);export{ir as component};
