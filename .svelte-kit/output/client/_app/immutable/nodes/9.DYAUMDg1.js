import{d as Fe,a as l,f as v,s as T,c as Ve,b as Ye}from"../chunks/zt7kUNSb.js";import{p as Ge,d as P,f as Be,o as Je,u as Ke,g as e,a as Re,b as D,e as Xe,s as u,c as o,$ as Ze,r as a,h as ne,t as C,n as z,i as $}from"../chunks/D02y27Ec.js";import{i as y}from"../chunks/CyaklKEO.js";import{e as ve,i as et}from"../chunks/CUJHGDU6.js";import{t as ce,a as tt,f as rt}from"../chunks/Mk7LNAF3.js";import{h as at,c as ue,s as K,b as j,r as pe}from"../chunks/DG2cR9Zm.js";import{b as fe}from"../chunks/7bhswH3j.js";import{a as ot,s as st}from"../chunks/HxVFllSf.js";import{p as it}from"../chunks/t4rw-3Qc.js";import{a as w}from"../chunks/0ZKSTxe_.js";import{I as me}from"../chunks/_BBJ39LF.js";import{S as dt,C as lt}from"../chunks/Cir_xdE4.js";import{C as nt}from"../chunks/D95vVFjk.js";import{a as vt,C as ct}from"../chunks/DbfI9puR.js";var ut=v('<div class="glass-card-static p-8 h-36 animate-pulse"></div>'),pt=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>'),ft=v('<div class="flex items-center gap-1 text-[10px] font-black uppercase text-gov-red"><!> Expired</div>'),mt=v('<div class="flex items-center gap-1 text-[10px] font-black uppercase text-gov-gold-dark"><!> Upcoming</div>'),_t=v('<div class="flex items-center gap-1 text-[10px] font-black uppercase text-gov-green"><!> Active</div>'),gt=v('<div class="flex items-center gap-1 text-[10px] font-black uppercase text-text-muted"><!> Admin View</div>'),bt=v('<button class="p-2.5 rounded-xl bg-gov-blue/5 text-gov-blue hover:bg-gov-blue hover:text-white active:scale-95 transition-all shadow-sm flex items-center justify-center"><!></button>'),xt=v('<input type="date" class="w-full px-4 py-3.5 bg-white/50 border border-gray-100 rounded-2xl focus:ring-2 focus:ring-gov-blue/20 focus:border-gov-blue outline-none text-sm font-semibold transition-all"/>'),ht=v('<p class="w-full px-4 py-3.5 bg-white/30 border border-gray-100 rounded-2xl text-sm font-semibold text-text-primary"> </p>'),yt=v('<input type="text" placeholder="e.g. DLL Submission..." class="w-full px-4 py-3.5 bg-white/50 border border-gray-100 rounded-2xl focus:ring-2 focus:ring-gov-blue/20 focus:border-gov-blue outline-none text-sm font-medium placeholder:text-gray-300 transition-all"/>'),wt=v('<p class="w-full px-4 py-3.5 bg-white/30 border border-gray-100 rounded-2xl text-sm font-medium text-text-secondary"> </p>'),kt=v('<div class="glass-card-static p-8 group relative overflow-hidden"><div class="flex items-center justify-between mb-8"><div class="flex items-center gap-4"><div class="w-14 h-14 rounded-2xl bg-gov-blue text-white flex items-center justify-center font-black text-xl shadow-lg shadow-gov-blue/20"> </div> <div><h3 class="font-black text-text-primary text-lg"> </h3> <div class="flex items-center gap-1.5 mt-1"><!></div></div></div> <!></div> <div class="space-y-4"><div class="relative"><label class="absolute -top-2 left-3 px-1 bg-white text-[10px] font-bold text-gov-blue uppercase tracking-widest z-10">Due Date</label> <!></div> <div class="relative"><label class="absolute -top-2 left-3 px-1 bg-white text-[10px] font-bold text-text-muted uppercase tracking-widest z-10">Notes / Purpose</label> <!></div></div></div>'),St=v(`<div class="mt-12 p-8 bg-surface border border-border-subtle rounded-[2.5rem] shadow-sm"><div class="flex items-start gap-4"><div class="p-2.5 rounded-xl bg-gov-blue/10 text-gov-blue group-hover:bg-gov-blue group-hover:text-white transition-all"><!></div> <div><h4 class="font-bold text-text-primary text-lg mb-1">Operational Guidelines</h4> <p class="text-sm text-text-secondary leading-relaxed">Each week is saved individually by clicking the <span class="inline-flex items-center justify-center px-2 py-0.5 rounded bg-gov-blue/10 text-gov-blue font-bold text-[10px] uppercase">Save</span> icon. Deadlines are set to <strong>11:59 PM</strong> of the selected date. Submissions
                            after this will be marked as "Late" or "Non-compliant"
                            automatically.</p></div></div></div>`),Dt=v(`<div class="mt-12 p-8 bg-surface border border-border-subtle rounded-[2.5rem] shadow-sm"><div class="flex items-start gap-4"><div class="p-2.5 rounded-xl bg-gov-green/10 text-gov-green"><!></div> <div><h4 class="font-bold text-text-primary text-lg mb-1">Submission Protocols</h4> <p class="text-sm text-text-secondary leading-relaxed">Submit your documents before the deadline to be
                            marked as <strong>Compliant</strong>. Submissions after the
                            deadline are marked as <strong>Late</strong> or <strong>Non-compliant</strong>. Contact your
                            supervisor if you need deadline adjustments.</p></div></div></div>`),Ct=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-8"></div> <!>',1),zt=v(`<div class="max-w-4xl mx-auto"><div class="mb-10 flex flex-col md:flex-row md:items-end justify-between gap-6"><div><h1 class="text-3xl font-black text-text-primary tracking-tight">Academic Calendar</h1> <p class="text-base text-text-secondary mt-1 font-medium max-w-lg">Manage submission deadlines and institutional timeline for the
                current school year.</p></div> <div class="flex items-center gap-3 p-1.5 bg-surface-muted rounded-2xl border border-border-subtle shadow-sm"><select class="px-4 py-2 bg-transparent border-none rounded-xl focus:ring-0 outline-none text-sm font-bold text-gov-blue cursor-pointer"><option>2024-2025</option><option>2025-2026</option></select> <div class="w-px h-4 bg-border-subtle"></div> <select class="px-4 py-2 bg-transparent border-none rounded-xl focus:ring-0 outline-none text-sm font-bold text-gov-blue cursor-pointer"><option>1st Quarter</option><option>2nd Quarter</option><option>3rd Quarter</option><option>4th Quarter</option></select></div></div> <!></div>`);function Ut(_e,ge){Ge(ge,!0);const k=()=>st(it,"$profile",be),[be,xe]=ot();let I=P("2025-2026"),N=P(1),R=P(Be([])),X=P(!0),b=P(null);const he=$(()=>k()?.role==="Teacher"),S=$(()=>!e(he));Je(async()=>{try{if(k()?.district_id)D(b,k().district_id,!0),console.log("[v0] District ID from profile:",e(b));else if(k()?.school_id){const{data:t,error:d}=await K.from("schools").select("district_id").eq("id",k().school_id).single();d?console.error("[v0] Error resolving district from school:",d):(D(b,t?.district_id||null,!0),console.log("[v0] District ID resolved from school:",e(b)))}else console.error("[v0] No district_id or school_id found in profile:",k());e(b)?await Z():w("warning","Unable to load calendar for your school/district")}catch(t){console.error("[v0] Error in calendar onMount:",t),w("error","Failed to load calendar")}finally{D(X,!1)}});async function Z(){if(!e(b))return;const{data:t,error:d}=await K.from("academic_calendar").select("*").eq("school_year",e(I)).eq("quarter",e(N)).eq("district_id",e(b)).order("week_number",{ascending:!0});if(d){console.error("[v0] Error loading calendar:",d);return}const n=t||[];D(R,Array.from({length:10},(_,W)=>{const q=W+1,c=n.find(s=>s.week_number===q);return{id:c?.id,week_number:q,deadline_date:c?.deadline_date?c.deadline_date.split("T")[0]:"",description:c?.description||`Week ${q} Submission`}}),!0)}async function ye(t){if(!e(S)){w("error","You don't have permission to edit the calendar");return}if(!e(b)){w("error","Unable to determine your district. Please refresh the page."),console.error("[v0] Save error: No district ID resolved");return}if(!t.deadline_date){w("error","Please set a deadline date for this week");return}const d={...t.id?{id:t.id}:{},school_year:e(I),quarter:e(N),week_number:t.week_number,deadline_date:new Date(t.deadline_date).toISOString(),description:t.description,district_id:e(b)};console.log("[v0] Saving week with payload:",d);const{data:n,error:_}=await K.from("academic_calendar").upsert(d).select();_?(console.error("[v0] Save error:",_),w("error",`Failed to save Week ${t.week_number}: ${_.message}`)):(w("success",`Week ${t.week_number} updated!`),n&&n[0]&&(t.id=n[0].id))}function we(t){if(!t)return!1;const d=new Date(t);return d.setHours(23,59,59,999),new Date>d}function ke(t){if(!t)return!1;const d=new Date(t);d.setHours(0,0,0,0);const n=new Date;n.setHours(0,0,0,0);const _=new Date(n.getTime()+4320*60*1e3);return _.setHours(23,59,59,999),d>=n&&d<=_}Ke(()=>{(e(I)||e(N))&&Z()});var H=zt();at("140v80w",t=>{Xe(()=>{Ze.title="Academic Calendar — Smart E-VISION"})});var L=o(H),ee=u(o(L),2),A=o(ee),M=o(A);M.value=M.__value="2024-2025";var te=u(M);te.value=te.__value="2025-2026",a(A);var Q=u(A,4),U=o(Q);U.value=U.__value=1;var O=u(U);O.value=O.__value=2;var F=u(O);F.value=F.__value=3;var re=u(F);re.value=re.__value=4,a(Q),a(ee),a(L);var Se=u(L,2);{var De=t=>{var d=pt();ve(d,20,()=>Array(6),et,(n,_)=>{var W=ut();l(n,W)}),a(d),l(t,d)},Ce=t=>{var d=Ct(),n=ne(d);ve(n,23,()=>e(R),c=>c.week_number,(c,s,f)=>{var g=kt(),h=o(g),V=o(h),Y=o(V),ze=o(Y,!0);a(Y);var ae=u(Y,2),G=o(ae),Ie=o(G);a(G);var oe=u(G,2),Ne=o(oe);{var We=i=>{var r=Ve(),p=ne(r);{var J=x=>{var m=ft(),E=o(m);nt(E,{size:10}),z(),a(m),l(x,m)},Me=$(()=>we(e(s).deadline_date)),Qe=x=>{var m=mt(),E=o(m);vt(E,{size:10}),z(),a(m),l(x,m)},Ue=$(()=>ke(e(s).deadline_date)),Oe=x=>{var m=_t(),E=o(m);ct(E,{size:10}),z(),a(m),l(x,m)};y(p,x=>{e(Me)?x(J):e(Ue)?x(Qe,1):x(Oe,!1)})}l(i,r)},qe=i=>{var r=gt(),p=o(r);me(p,{size:10}),z(),a(r),l(i,r)};y(Ne,i=>{!e(S)&&e(s).deadline_date?i(We):i(qe,!1)})}a(oe),a(ae),a(V);var Ee=u(V,2);{var Pe=i=>{var r=bt(),p=o(r);dt(p,{size:20,strokeWidth:2.5}),a(r),C(()=>j(r,"title",`Save Week ${e(s).week_number??""}`)),Ye("click",r,()=>ye(e(s))),l(i,r)};y(Ee,i=>{e(S)&&i(Pe)})}a(h);var se=u(h,2),B=o(se),ie=o(B),je=u(ie,2);{var Ae=i=>{var r=xt();pe(r),C(()=>j(r,"id",`date-${e(f)??""}`)),fe(r,()=>e(s).deadline_date,p=>e(s).deadline_date=p),l(i,r)},Te=i=>{var r=ht(),p=o(r,!0);a(r),C(J=>T(p,J),[()=>e(s).deadline_date?new Date(e(s).deadline_date+"T00:00:00").toLocaleDateString("en-PH",{weekday:"long",month:"long",day:"numeric",year:"numeric"}):"Not set"]),l(i,r)};y(je,i=>{e(S)?i(Ae):i(Te,!1)})}a(B);var de=u(B,2),le=o(de),$e=u(le,2);{var He=i=>{var r=yt();pe(r),C(()=>j(r,"id",`desc-${e(f)??""}`)),fe(r,()=>e(s).description,p=>e(s).description=p),l(i,r)},Le=i=>{var r=wt(),p=o(r,!0);a(r),C(()=>T(p,e(s).description||"—")),l(i,r)};y($e,i=>{e(S)?i(He):i(Le,!1)})}a(de),a(se),a(g),C(()=>{T(ze,e(s).week_number),T(Ie,`Week ${e(s).week_number??""}`),j(ie,"for",`date-${e(f)??""}`),j(le,"for",`desc-${e(f)??""}`)}),ce(1,g,()=>tt,()=>({y:20,delay:e(f)*50})),l(c,g)}),a(n);var _=u(n,2);{var W=c=>{var s=St(),f=o(s),g=o(f),h=o(g);me(h,{size:24}),a(g),z(2),a(f),a(s),l(c,s)},q=c=>{var s=Dt(),f=o(s),g=o(f),h=o(g);lt(h,{size:24}),a(g),z(2),a(f),a(s),l(c,s)};y(_,c=>{e(S)?c(W):c(q,!1)})}ce(1,n,()=>rt),l(t,d)};y(Se,t=>{e(X)?t(De):t(Ce,!1)})}a(H),ue(A,()=>e(I),t=>D(I,t)),ue(Q,()=>e(N),t=>D(N,t)),l(_e,H),Re(),xe()}Fe(["click"]);export{Ut as component};
